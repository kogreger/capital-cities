# Capital Cities (Urban Mobility)

```{r initialization, eval = TRUE, echo = FALSE, message = FALSE}
## initialize and load required packages
library(ggplot2)
library(gridExtra)
library(RPostgreSQL)
library(scales)

## initialize database connection and psql helper functions
drv <- dbDriver("PostgreSQL")
con <- dbConnect(drv, 
                 host = "localhost", 
                 port = "1111", 
                 user = "postgres", 
                 password = "postgres", 
                 dbname = "pflow")

source("psqlHelper.R")

## initialize ggplot
theme_set(theme_bw())
```

```{r loadVariableLabels, eval = TRUE, echo = FALSE, message = FALSE}
# load variable labels
labelsSex <- read.table("labels_all_sex.txt", sep = "\t")
labelsAge <- read.table("labels_all_age.txt", sep = "\t")
labelsOccupC <- read.table("labels_all_occupc.txt", sep = "\t")
labelsActivity <- read.table("labels_all_activity.txt", sep = "\t")
labelsTModeC <- read.table("labels_all_tmodec.txt", sep = "\t")
labelsDhk09Occup <- read.table("labels_dhk09_occup.txt", sep = "\t")
labelsHni04Occup <- read.table("labels_hni04_occup.txt", sep = "\t")
labelsJkt02Occup <- read.table("labels_jkt02_occup.txt", sep = "\t")
labelsMnl96Occup <- read.table("labels_mnl96_occup.txt", sep = "\t")
labelsDhk09Purpose <- read.table("labels_dhk09_purpose.txt", sep = "\t")
labelsHni04Purpose <- read.table("labels_hni04_purpose.txt", sep = "\t")
labelsJkt02Purpose <- read.table("labels_jkt02_purpose.txt", sep = "\t")
labelsMnl96Purpose <- read.table("labels_mnl96_purpose.txt", sep = "\t")
labelsDhk09TMode <- read.table("labels_dhk09_tmode.txt", sep = "\t")
labelsHni04TMode <- read.table("labels_hni04_tmode.txt", sep = "\t")
labelsJkt02TMode <- read.table("labels_jkt02_tmode.txt", sep = "\t")
labelsMnl96TMode <- read.table("labels_mnl96_tmode.txt", sep = "\t")
```


## Sample Populations

This section covers the descriptive statistics of the four sample populations.

### Dhaka 2009

```{r loadDhk09Person, eval = TRUE, echo = FALSE}
# load person data
dhk09.person <- psqlGetTable(con, "dhk09", "person")
# remove unnecessary columns (padd, magfac, magfac2)
dhk09.person <- dhk09.person[, c("pid", "sex", "age", "occup", "occupc")]
# factorize pid
dhk09.person$pid <- factor(dhk09.person$pid)
# remove NA sex (=0) and factorize
dhk09.person <- dhk09.person[dhk09.person$sex != 0, ]
dhk09.person$sex <- factor(dhk09.person$sex, 
                           levels = c(1, 2), 
                           labels = labelsSex[, 2])
# factorize age (ordered)
dhk09.person$age <- factor(dhk09.person$age, 
                           levels = c(0:17), 
                           ordered = TRUE, 
                           labels = labelsAge[, 2])
# factorize occupation
dhk09.person$occup <- factor(dhk09.person$occup, 
                             levels = c(0:8), 
                             labels = labelsDhk09Occup[, 2])
# factorize occupation class
dhk09.person$occupc <- factor(dhk09.person$occupc, 
                              levels = c(1:5, 99), 
                              labels = labelsOccupC[, 2])
```

The data were captured on October 1-2, 2009 with a sample size of `r format(nrow(dhk09.person), big.mark=",")` people.

Data set description:

```{r descDhk09Person}
format(object.size(dhk09.person), units = "auto")
names(dhk09.person)
str(dhk09.person)
levels(dhk09.person$sex)
levels(dhk09.person$age)
levels(dhk09.person$occup)
levels(dhk09.person$occupc)
with(dhk09.person, table(age, sex))
```

```{r plotHistDhk09Person, eval = TRUE, echo = FALSE, fig.width = 7, fig.height = 28}
plotDhk09Sex <- ggplot(dhk09.person, aes(sex)) +
  geom_bar() +
  scale_y_continuous(labels = comma) +
  scale_x_discrete(limits = labelsSex[, 2]) +
  labs(title = "Dhaka 2009, Sex", x = "Sex", y = "Count")
plotDhk09Age <- ggplot(dhk09.person, aes(age)) +
  geom_bar() +
  scale_y_continuous(labels = comma) +
  scale_x_discrete(limits = labelsAge[, 2]) +
  labs(title = "Dhaka 2009, Age", x = "Age", y = "Count") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
plotDhk09Occup <- ggplot(dhk09.person, aes(occup)) +
  geom_bar() +
  scale_y_continuous(labels = comma) +
  scale_x_discrete(limits = labelsDhk09Occup[, 2]) +
  labs(title = "Dhaka 2009, Occupation", x = "Occupation", y = "Count") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
plotDhk09OccupC <- ggplot(dhk09.person, aes(occupc)) +
  geom_bar() +
  scale_y_continuous(labels = comma) +
  scale_x_discrete(limits = labelsOccupC[, 2]) +
  labs(title = "Dhaka 2009, Occupation Group", 
       x = "Occupation Group", 
       y = "Count") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
grid.arrange(plotDhk09Sex, plotDhk09Age, plotDhk09Occup, plotDhk09OccupC, 
             ncol = 1)
```


### Hanoi 2004

```{r loadHni04Person, eval = TRUE, echo = FALSE}
# load person data
hni04.person <- psqlGetTable(con, "hni04", "person")
# remove unnecessary columns (padd, magfac, magfac2)
hni04.person <- hni04.person[, c("pid", "sex", "age", "occup", "occupc")]
# factorize pid
hni04.person$pid <- factor(hni04.person$pid)
# factorize sex
hni04.person$sex <- factor(hni04.person$sex, 
                           levels = c(1, 2), 
                           labels = labelsSex[, 2])
# factorize age (ordered)
hni04.person$age <- factor(hni04.person$age, 
                           levels = c(0:17), 
                           ordered = TRUE, 
                           labels = labelsAge[, 2])
# factorize occupation
hni04.person$occup <- factor(hni04.person$occup, 
                             levels = c(0:16, 99), 
                             labels = labelsHni04Occup[, 2])
# factorize occupation class
hni04.person$occupc <- factor(hni04.person$occupc, 
                              levels = c(1:5, 99), 
                              labels = labelsOccupC[, 2])
```

The data were captured on October 1-2, 2004 with a sample size of `r format(nrow(hni04.person), big.mark=",")` people.

Data set description:

```{r descHni04Person}
format(object.size(hni04.person), units = "auto")
names(hni04.person)
str(hni04.person)
levels(hni04.person$sex)
levels(hni04.person$age)
levels(hni04.person$occup)
levels(hni04.person$occupc)
with(hni04.person, table(age, sex))
```

```{r plotHistHni04Person, eval = TRUE, echo = FALSE, fig.width = 7, fig.height = 28}
plotHni04Sex <- ggplot(hni04.person, aes(sex)) +
  geom_bar() +
  scale_y_continuous(labels = comma) +
  scale_x_discrete(limits = labelsSex[, 2]) +
  labs(title = "Hanoi 2004, Sex", x = "Sex", y = "Count")
plotHni04Age <- ggplot(hni04.person, aes(age)) +
  geom_bar() +
  scale_y_continuous(labels = comma) +
  scale_x_discrete(limits = labelsAge[, 2]) +
  labs(title = "Hanoi 2004, Age", x = "Age", y = "Count") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
plotHni04Occup <- ggplot(hni04.person, aes(occup)) +
  geom_bar() +
  scale_y_continuous(labels = comma) +
  scale_x_discrete(limits = labelsHni04Occup[, 2]) +
  labs(title = "Hanoi 2004, Occupation", x = "Occupation", y = "Count") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
plotHni04OccupC <- ggplot(hni04.person, aes(occupc)) +
  geom_bar() +
  scale_y_continuous(labels = comma) +
  scale_x_discrete(limits = labelsOccupC[, 2]) +
  labs(title = "Hanoi 2004, Occupation Group", 
       x = "Occupation Group", 
       y = "Count") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
grid.arrange(plotHni04Sex, plotHni04Age, plotHni04Occup, plotHni04OccupC, 
             ncol = 1)
```


### Jakarta 2002

```{r loadJkt02Person, eval = TRUE, echo = FALSE}
# load person data
jkt02.person <- psqlGetTable(con, "jkt02", "person")
# remove unnecessary columns (padd, magfac, magfac2)
jkt02.person <- jkt02.person[, c("pid", "sex", "age", "occup", "occupc")]
# factorize pid
jkt02.person$pid <- factor(jkt02.person$pid)
# factorize sex
jkt02.person$sex <- factor(jkt02.person$sex, 
                           levels = c(1, 2), 
                           labels = labelsSex[, 2])
# factorize age (ordered, no 0)
jkt02.person$age <- factor(jkt02.person$age, 
                           levels = c(0:17), 
                           ordered = TRUE, 
                           labels = labelsAge[, 2])
# factorize occupation
jkt02.person$occup <- factor(jkt02.person$occup, 
                             levels = c(0:17, 99), 
                             labels = labelsJkt02Occup[, 2])
# factorize occupation class
jkt02.person$occupc <- factor(jkt02.person$occupc, 
                              levels = c(1:5, 99), 
                              labels = labelsOccupC[, 2])
```

The data were captured on October 1-2, 2002 with a sample size of `r format(nrow(jkt02.person), big.mark=",")` people.

Data set description:

```{r descJkt02Person}
format(object.size(jkt02.person), units = "auto")
names(jkt02.person)
str(jkt02.person)
levels(jkt02.person$sex)
levels(jkt02.person$age)
levels(jkt02.person$occup)
levels(jkt02.person$occupc)
with(jkt02.person, table(age, sex))
```

```{r plotHistJkt02Person, eval = TRUE, echo = FALSE, fig.width = 7, fig.height = 28}
plotJkt02Sex <- ggplot(jkt02.person, aes(sex)) +
  geom_bar() +
  scale_y_continuous(labels = comma) +
  scale_x_discrete(limits = labelsSex[, 2]) +
  labs(title = "Jakarta 2002, Sex", x = "Sex", y = "Count")
plotJkt02Age <- ggplot(jkt02.person, aes(age)) +
  geom_bar() +
  scale_y_continuous(labels = comma) +
  scale_x_discrete(limits = labelsAge[, 2]) +
  labs(title = "Jakarta 2002, Age", x = "Age", y = "Count") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
plotJkt02Occup <- ggplot(jkt02.person, aes(occup)) +
  geom_bar() +
  scale_y_continuous(labels = comma) +
  scale_x_discrete(limits = labelsJkt02Occup[, 2]) +
  labs(title = "Jakarta 2002, Occupation", x = "Occupation", y = "Count") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
plotJkt02OccupC <- ggplot(jkt02.person, aes(occupc)) +
  geom_bar() +
  scale_y_continuous(labels = comma) +
  scale_x_discrete(limits = labelsOccupC[, 2]) +
  labs(title = "Jakarta 2002, Occupation Group", 
       x = "Occupation Group", 
       y = "Count") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
grid.arrange(plotJkt02Sex, plotJkt02Age, plotJkt02Occup, plotJkt02OccupC, 
             ncol = 1)
```


### Metro Manila 1996

```{r loadMnl96Person, eval = TRUE, echo = FALSE}
# load person data
mnl96.person <- psqlGetTable(con, "mnl96", "person")
# remove unnecessary columns (padd, magfac, magfac2)
mnl96.person <- mnl96.person[, c("pid", "sex", "age", "occup", "occupc")]
# factorize pid
mnl96.person$pid <- factor(mnl96.person$pid)
# factorize sex
mnl96.person$sex <- factor(mnl96.person$sex, 
                           levels = c(1, 2), 
                           labels = labelsSex[, 2])
# factorize age (ordered, no 0)
mnl96.person$age <- factor(mnl96.person$age, 
                           levels = c(0:17), 
                           ordered = TRUE, 
                           labels = labelsAge[, 2])
# factorize occupation
mnl96.person$occup <- factor(mnl96.person$occup, 
                             levels = c(1:14, 99), 
                             labels = labelsMnl96Occup[, 2])
# factorize occupation class
mnl96.person$occupc <- factor(mnl96.person$occupc, 
                              levels = c(1:5, 99), 
                              labels = labelsOccupC[, 2])
```

The data were captured on October 1-2, 1996 with a sample size of `r format(nrow(mnl96.person), big.mark=",")` people.

Data set description:

```{r descMnl96Person}
format(object.size(mnl96.person), units = "auto")
names(mnl96.person)
str(mnl96.person)
levels(mnl96.person$sex)
levels(mnl96.person$age)
levels(mnl96.person$occup)
levels(mnl96.person$occupc)
with(mnl96.person, table(age, sex))
```

```{r plotHistMnl96Person, eval = TRUE, echo = FALSE, fig.width = 7, fig.height = 28}
plotMnl96Sex <- ggplot(mnl96.person, aes(sex)) +
  geom_bar() +
  scale_y_continuous(labels = comma) +
  scale_x_discrete(limits = labelsSex[, 2]) +
  labs(title = "Metro Manila 1996, Sex", x = "Sex", y = "Count")
plotMnl96Age <- ggplot(mnl96.person, aes(age)) +
  geom_bar() +
  scale_y_continuous(labels = comma) +
  scale_x_discrete(limits = labelsAge[, 2]) +
  labs(title = "Metro Manila 1996, Age", x = "Age", y = "Count") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
plotMnl96Occup <- ggplot(mnl96.person, aes(occup)) +
  geom_bar() +
  scale_y_continuous(labels = comma) +
  scale_x_discrete(limits = labelsMnl96Occup[, 2]) +
  labs(title = "Metro Manila 1996, Occupation", x = "Occupation", y = "Count") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
plotMnl96OccupC <- ggplot(mnl96.person, aes(occupc)) +
  geom_bar() +
  scale_y_continuous(labels = comma) +
  scale_x_discrete(limits = labelsOccupC[, 2]) +
  labs(title = "Metro Manila 1996, Occupation Group", 
       x = "Occupation Group", 
       y = "Count") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
grid.arrange(plotMnl96Sex, plotMnl96Age, plotMnl96Occup, plotMnl96OccupC, 
             ncol = 1)
```


### Comparison Across Cities

#### Sex

```{r plotHistPersonSexAll, eval = TRUE, echo = FALSE, fig.width = 10, fig.height = 10}
grid.arrange(plotDhk09Sex, plotHni04Sex, plotJkt02Sex, plotMnl96Sex, 
             ncol = 2, 
             main = "Sex")
```

#### Age

```{r plotHistPersonAgeAll, eval = TRUE, echo = FALSE, fig.width = 10, fig.height = 10}
grid.arrange(plotDhk09Age, plotHni04Age, plotJkt02Age, plotMnl96Age, 
             ncol = 2, 
             main = "Age")
```

#### Occupation

```{r plotHistPersonOccupAll, eval = TRUE, echo = FALSE, fig.width = 10, fig.height = 10}
grid.arrange(plotDhk09Occup, plotHni04Occup, plotJkt02Occup, plotMnl96Occup, 
             ncol = 2, 
             main = "Occupation")
```

#### Occupation Group

```{r plotHistPersonOccupcAll, eval = TRUE, echo = FALSE, fig.width = 10, fig.height = 10}
grid.arrange(plotDhk09OccupC, plotHni04OccupC, plotJkt02OccupC, plotMnl96OccupC, 
             ncol = 2, 
             main = "Occupation Group")
```


## Sample Trips

### Dhaka 2009

```{r loadTripsDhk09, eval = TRUE, echo = FALSE}
# load trip data
dhk09.trip <- psqlGetTable(con, "dhk09", "trip")
# remove unnecessary column (purpose, puid_s, puid_e)
dhk09.trip <- dhk09.trip[, c("pid", "tno", "activity", "dist", 
                             "pdate_s", "pdate_e")]
# factorize pid
dhk09.trip$pid <- factor(dhk09.trip$pid)
# factorize tno
dhk09.trip$tno <- factor(dhk09.trip$tno)
# factorize activity
dhk09.trip$activity <- factor(dhk09.trip$activity, 
                              levels = c(1:6, 99), 
                              labels = labelsActivity[, 2])
# merge trip data with person data
#dhk09.trip.person <- merge(dhk09.trip, dhk09.person, by="pid")
```

Data set description:

```{r descDhk09Trip}
format(object.size(dhk09.trip), units = "auto")
names(dhk09.trip)
str(dhk09.trip)
levels(dhk09.trip$activity)
table(dhk09.trip$activity)
```

```{r plotHistDhk09Trip, eval = TRUE, echo = FALSE, fig.width = 7, fig.height = 7}
plotDhk09Activity <- ggplot(dhk09.trip, aes(activity)) +
  geom_bar() +
  scale_y_continuous(labels = comma) + 
  scale_x_discrete(limits = labelsActivity[, 2]) + 
  labs(title = "Dhaka 2009, Activity", x = "Activity", y = "Count")
grid.arrange(plotDhk09Activity, 
             ncol = 1)
```

### Hanoi 2004

```{r loadTripsHni04, eval = TRUE, echo = FALSE}
# load trip data
hni04.trip <- psqlGetTable(con, "hni04", "trip")
# remove unnecessary column (purpose, puid_s, puid_e)
hni04.trip <- hni04.trip[, c("pid", "tno", "activity", "dist", 
                             "pdate_s", "pdate_e")]
# factorize pid
hni04.trip$pid <- factor(hni04.trip$pid)
# factorize tno
hni04.trip$tno <- factor(hni04.trip$tno)
# factorize activity
hni04.trip$activity <- factor(hni04.trip$activity, 
                              levels = c(1:6, 99), 
                              labels = labelsActivity[, 2])
# merge trip data with person data
#hni04.trip.person <- merge(hni04.trip, hni04.person, by="pid")
```

Data set description:

```{r descHni04Trip}
format(object.size(hni04.trip), units = "auto")
names(hni04.trip)
str(hni04.trip)
levels(hni04.trip$activity)
table(hni04.trip$activity)
```

```{r plotHistHni04Trip, eval = TRUE, echo = FALSE, fig.width = 7, fig.height = 7}
plotHni04Activity <- ggplot(hni04.trip, aes(activity)) +
  geom_bar() +
  scale_y_continuous(labels = comma) + 
  scale_x_discrete(limits = labelsActivity[, 2]) + 
  labs(title = "Hanoi 2004, Activity", x = "Activity", y = "Count")
grid.arrange(plotHni04Activity, 
             ncol = 1)
```

### Jakarta 2002

```{r loadTripsJkt02, eval = TRUE, echo = FALSE}
# load trip data
jkt02.trip <- psqlGetTable(con, "jkt02", "trip")
# remove unnecessary column (purpose, puid_s, puid_e)
jkt02.trip <- jkt02.trip[, c("pid", "tno", "activity", "dist", 
                             "pdate_s", "pdate_e")]
# factorize pid
jkt02.trip$pid <- factor(jkt02.trip$pid)
# factorize tno
jkt02.trip$tno <- factor(jkt02.trip$tno)
# factorize activity
jkt02.trip$activity <- factor(jkt02.trip$activity, 
                              levels = c(1:6, 99), 
                              labels = labelsActivity[, 2])
# merge trip data with person data
#jkt02.trip.person <- merge(jkt02.trip, jkt02.person, by="pid")
```

Data set description:

```{r descJkt02Trip}
format(object.size(jkt02.trip), units = "auto")
names(jkt02.trip)
str(jkt02.trip)
levels(jkt02.trip$activity)
table(jkt02.trip$activity)
```

```{r plotHistJkt02Trip, eval = TRUE, echo = FALSE, fig.width = 7, fig.height = 7}
plotJkt02Activity <- ggplot(jkt02.trip, aes(activity)) +
  geom_bar() +
  scale_y_continuous(labels = comma) + 
  scale_x_discrete(limits = labelsActivity[, 2]) + 
  labs(title = "Jakarta 2002, Activity", x = "Activity", y = "Count")
grid.arrange(plotJkt02Activity, 
             ncol = 1)
```

### Metro Manila 1996

```{r loadTripsMnl96, eval = TRUE, echo = FALSE}
# load trip data
mnl96.trip <- psqlGetTable(con, "mnl96", "trip")
# remove unnecessary column (purpose, puid_s, puid_e)
mnl96.trip <- mnl96.trip[, c("pid", "tno", "activity", "dist", 
                             "pdate_s", "pdate_e")]
# factorize pid
mnl96.trip$pid <- factor(mnl96.trip$pid)
# factorize tno
mnl96.trip$tno <- factor(mnl96.trip$tno)
# factorize activity
mnl96.trip$activity <- factor(mnl96.trip$activity, 
                              levels = c(1:6, 99), 
                              labels = labelsActivity[, 2])
# merge trip data with person data
#mnl96.trip.person <- merge(mnl96.trip, mnl96.person, by="pid")
```

Data set description:

```{r descMnl96Trip}
format(object.size(mnl96.trip), units = "auto")
names(mnl96.trip)
str(mnl96.trip)
levels(mnl96.trip$activity)
table(mnl96.trip$activity)
```

```{r plotHistMnl96Trip, eval = TRUE, echo = FALSE, fig.width = 7, fig.height = 7}
plotMnl96Activity <- ggplot(mnl96.trip, aes(activity)) +
  geom_bar() +
  scale_y_continuous(labels = comma) + 
  scale_x_discrete(limits = labelsActivity[, 2]) + 
  labs(title = "Metro Manila 1996, Activity", x = "Activity", y = "Count")
grid.arrange(plotMnl96Activity, 
             ncol = 1)
```

### Comparison Across Cities

```{r plotHistTripActivityAll, eval = TRUE, echo = FALSE, fig.width = 10, fig.height = 10}
grid.arrange(plotDhk09Activity, plotHni04Activity, 
             plotJkt02Activity, plotMnl96Activity, 
             ncol = 2, 
             main = "Activity")
```


## Sample Subtrips

### Dhaka 2009

```{r loadSubtripsDhk09, eval = TRUE, echo = FALSE}
# load trip data
dhk09.subtrip <- psqlGetTable(con, "dhk09", "subtrip")
# remove unnecessary column (purpose, puid_s, puid_e)
dhk09.subtrip <- dhk09.subtrip[, c("pid", "tno", "sno", "tmode", "tmodec", 
                                   "activity", "dist", "pdate_s", "pdate_e")]
# factorize pid
dhk09.subtrip$pid <- factor(dhk09.subtrip$pid)
# factorize tno
dhk09.subtrip$tno <- factor(dhk09.subtrip$tno)
# factorize sno
dhk09.subtrip$sno <- factor(dhk09.subtrip$sno)
# factorize mode of transportation
dhk09.subtrip$tmode <- factor(dhk09.subtrip$tmode, 
                                 levels = c(1:20, 97, 99), 
                                 labels = labelsDhk09TMode[, 2])
# remove unnecessary mode of transportation classes (10, 97, 99) and factorize
dhk09.subtrip <- dhk09.subtrip[dhk09.subtrip$tmodec != 10 & 
                               dhk09.subtrip$tmodec != 97 & 
                               dhk09.subtrip$tmodec != 99, ]
dhk09.subtrip$tmodec <- factor(dhk09.subtrip$tmodec, 
                               levels = c(1:9), 
                               labels = labelsTModeC[c(1:9), 2])
# factorize activity
dhk09.subtrip$activity <- factor(dhk09.subtrip$activity, 
                                 levels = c(1:6, 99), 
                                 labels = labelsActivity[, 2])
# merge subtrip data with person data
dhk09.subtrip.person <- merge(dhk09.subtrip, dhk09.person, by="pid")
```

Data set description:

```{r descDhk09Subtrip}
format(object.size(dhk09.subtrip), units = "auto")
names(dhk09.subtrip)
str(dhk09.subtrip)
levels(dhk09.subtrip$tmodec)
table(dhk09.subtrip$tmodec)
levels(dhk09.subtrip$activity)
table(dhk09.subtrip$activity)
```

```{r plotHistDhk09Subtrip, eval = TRUE, echo = FALSE, fig.width = 7, fig.height = 7}
plotDhk09TModeC <- ggplot(dhk09.subtrip, aes(tmodec)) +
  geom_bar() +
  scale_y_continuous(labels = comma) + 
  scale_x_discrete(limits = labelsTModeC[c(1:9), 2]) + 
  labs(title = "Dhaka 2009, Mode of Transportation", 
       x = "Mode of Transportation", y = "Count")
grid.arrange(plotDhk09TModeC, 
             ncol = 1)
```

### Hanoi 2004

```{r loadSubtripsHni04, eval = TRUE, echo = FALSE}
# load trip data
hni04.subtrip <- psqlGetTable(con, "hni04", "subtrip")
# remove unnecessary column (purpose, puid_s, puid_e)
hni04.subtrip <- hni04.subtrip[, c("pid", "tno", "sno", "tmode", "tmodec", 
                                   "activity", "dist", "pdate_s", "pdate_e")]
# factorize pid
hni04.subtrip$pid <- factor(hni04.subtrip$pid)
# factorize tno
hni04.subtrip$tno <- factor(hni04.subtrip$tno)
# factorize sno
hni04.subtrip$sno <- factor(hni04.subtrip$sno)
# factorize mode of transportation
hni04.subtrip$tmode <- factor(hni04.subtrip$tmode, 
                                 levels = c(1:19, 97, 99), 
                                 labels = labelsHni04TMode[, 2])
# remove unnecessary mode of transportation classes (10, 97, 99) and factorize
hni04.subtrip <- hni04.subtrip[hni04.subtrip$tmodec != 10 & 
                               hni04.subtrip$tmodec != 97 & 
                               hni04.subtrip$tmodec != 99, ]
hni04.subtrip$tmodec <- factor(hni04.subtrip$tmodec, 
                               levels = c(1:9), 
                               labels = labelsTModeC[c(1:9), 2])
# factorize activity
hni04.subtrip$activity <- factor(hni04.subtrip$activity, 
                                 levels = c(1:6, 99), 
                                 labels = labelsActivity[, 2])
# merge subtrip data with person data
#hni04.subtrip.person <- merge(hni04.subtrip, hni04.person, by="pid")
```

Data set description:

```{r descHni04Subtrip}
format(object.size(hni04.subtrip), units = "auto")
names(hni04.subtrip)
str(hni04.subtrip)
levels(hni04.subtrip$tmodec)
table(hni04.subtrip$tmodec)
levels(hni04.subtrip$activity)
table(hni04.subtrip$activity)
```

```{r plotHistHni04Subtrip, eval = TRUE, echo = FALSE, fig.width = 7, fig.height = 7}
plotHni04TModeC <- ggplot(hni04.subtrip, aes(tmodec)) +
  geom_bar() +
  scale_y_continuous(labels = comma) + 
  scale_x_discrete(limits = labelsTModeC[c(1:9), 2]) + 
  labs(title = "Hanoi 2004, Mode of Transportation", 
       x = "Mode of Transportation", y = "Count")
grid.arrange(plotHni04TModeC, 
             ncol = 1)
```

### Jakarta 2002

```{r loadSubtripsJkt02, eval = TRUE, echo = FALSE}
# load trip data
jkt02.subtrip <- psqlGetTable(con, "jkt02", "subtrip")
# remove unnecessary column (purpose, puid_s, puid_e)
jkt02.subtrip <- jkt02.subtrip[, c("pid", "tno", "sno", "tmode", "tmodec", 
                                   "activity", "dist", "pdate_s", "pdate_e")]
# factorize pid
jkt02.subtrip$pid <- factor(jkt02.subtrip$pid)
# factorize tno
jkt02.subtrip$tno <- factor(jkt02.subtrip$tno)
# factorize sno
jkt02.subtrip$sno <- factor(jkt02.subtrip$sno)
# factorize mode of transportation
jkt02.subtrip$tmode <- factor(jkt02.subtrip$tmode, 
                                 levels = c(1:21, 97, 99), 
                                 labels = labelsJkt02TMode[, 2])
# remove unnecessary mode of transportation classes (10, 97, 99) and factorize
jkt02.subtrip <- jkt02.subtrip[jkt02.subtrip$tmodec != 10 & 
                               jkt02.subtrip$tmodec != 97 & 
                               jkt02.subtrip$tmodec != 99, ]
jkt02.subtrip$tmodec <- factor(jkt02.subtrip$tmodec, 
                               levels = c(1:9), 
                               labels = labelsTModeC[c(1:9), 2])
# factorize activity
jkt02.subtrip$activity <- factor(jkt02.subtrip$activity, 
                                 levels = c(1:6, 99), 
                                 labels = labelsActivity[, 2])
# merge subtrip data with person data
#jkt02.subtrip.person <- merge(jkt02.subtrip, jkt02.person, by="pid")
```

Data set description:

```{r descJkt02Subtrip}
format(object.size(jkt02.subtrip), units = "auto")
names(jkt02.subtrip)
str(jkt02.subtrip)
levels(jkt02.subtrip$tmodec)
table(jkt02.subtrip$tmodec)
levels(jkt02.subtrip$activity)
table(jkt02.subtrip$activity)
```

```{r plotHistJkt02Subtrip, eval = TRUE, echo = FALSE, fig.width = 7, fig.height = 7}
plotJkt02TModeC <- ggplot(jkt02.subtrip, aes(tmodec)) +
  geom_bar() +
  scale_y_continuous(labels = comma) + 
  scale_x_discrete(limits = labelsTModeC[c(1:9), 2]) + 
  labs(title = "Jakarta 2002, Mode of Transportation", 
       x = "Mode of Transportation", y = "Count")
grid.arrange(plotJkt02TModeC, 
             ncol = 1)
```

### Metro Manila 1996

```{r loadSubtripsMnl96, eval = TRUE, echo = FALSE}
# load trip data
mnl96.subtrip <- psqlGetTable(con, "mnl96", "subtrip")
# remove unnecessary column (purpose, puid_s, puid_e)
#mnl96.subtrip <- mnl96.subtrip[, c("pid", "tno", "sno", "tmode", "tmodec", 
#                                   "activity", "dist", "pdate_s", "pdate_e")]
mnl96.subtrip <- mnl96.subtrip[, c("pid", "tno", "sno", "tmode", "tmodec", 
                                   "activity", "dist")]
# factorize pid
mnl96.subtrip$pid <- factor(mnl96.subtrip$pid)
# factorize tno
mnl96.subtrip$tno <- factor(mnl96.subtrip$tno)
# factorize sno
mnl96.subtrip$sno <- factor(mnl96.subtrip$sno)
# factorize mode of transportation
mnl96.subtrip$tmode <- factor(mnl96.subtrip$tmode, 
                                 levels = c(1:19, 97, 99), 
                                 labels = labelsMnl96TMode[, 2])
# remove unnecessary mode of transportation classes (10, 97, 99) and factorize
mnl96.subtrip <- mnl96.subtrip[mnl96.subtrip$tmodec != 10 & 
                               mnl96.subtrip$tmodec != 97 & 
                               mnl96.subtrip$tmodec != 99, ]
mnl96.subtrip$tmodec <- factor(mnl96.subtrip$tmodec, 
                               levels = c(1:9), 
                               labels = labelsTModeC[c(1:9), 2])
# factorize activity
mnl96.subtrip$activity <- factor(mnl96.subtrip$activity, 
                                 levels = c(1:6, 99), 
                                 labels = labelsActivity[, 2])
# merge subtrip data with person data
#mnl96.subtrip.person <- merge(mnl96.subtrip, mnl96.person, by="pid")
```

Data set description:

```{r descMnl96Subtrip}
format(object.size(mnl96.subtrip), units = "auto")
names(mnl96.subtrip)
str(mnl96.subtrip)
levels(mnl96.subtrip$tmodec)
table(mnl96.subtrip$tmodec)
levels(mnl96.subtrip$activity)
table(mnl96.subtrip$activity)
```

```{r plotHistMnl96Subtrip, eval = TRUE, echo = FALSE, fig.width = 7, fig.height = 7}
plotMnl96TModeC <- ggplot(mnl96.subtrip, aes(tmodec)) +
  geom_bar() +
  scale_y_continuous(labels = comma) + 
  scale_x_discrete(limits = labelsTModeC[c(1:9), 2]) + 
  labs(title = "Metro Manila 1996, Mode of Transportation", 
       x = "Mode of Transportation", y = "Count")
grid.arrange(plotMnl96TModeC, 
             ncol = 1)
```

### Comparison Across Cities

```{r plotHistSubtripTModeCAll, eval = TRUE, echo = FALSE, fig.width = 10, fig.height = 10}
grid.arrange(plotDhk09TModeC, plotHni04TModeC, 
             plotJkt02TModeC, plotMnl96TModeC, 
             ncol = 2, 
             main = "Mode of Transportation Group")
```


## Mobility Behavior

### Dhaka 2009

### Hanoi 2004

### Jakarta 2002

### Metro Manila 1996


## Spatio-Temporal Distribution of Trip Origins

This section covers the analysis of the distribution of the origins of trips in all four cities over space and time. For analysis purposes we generated concentric ring buffers in 5km distances from the centers of all four cities (as per the OpenStreetMap data).



## Final Steps

It's always a good idea to clean up after you're done...

```{r cleanup, eval = TRUE, echo = FALSE, message = FALSE}
## clean up database connection and database driver
dbDisconnect(con)
dbUnloadDriver(drv)
```
